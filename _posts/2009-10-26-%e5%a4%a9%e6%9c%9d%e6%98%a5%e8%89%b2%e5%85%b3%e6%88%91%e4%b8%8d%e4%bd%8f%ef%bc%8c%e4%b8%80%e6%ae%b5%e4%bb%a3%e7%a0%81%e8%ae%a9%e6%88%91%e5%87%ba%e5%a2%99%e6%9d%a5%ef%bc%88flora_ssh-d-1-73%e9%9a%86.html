---
layout: post
status: publish
published: true
title: "天朝春色关我不住，一段代码让我出墙来（Flora_ssh-D 1.73隆重发布！）"
author:
  display_name: Leask
  login: leask
  email: i@leaskh.com
  url: http://www.leaskh.com
author_login: leask
author_email: i@leaskh.com
author_url: http://www.leaskh.com
wordpress_id: 55
wordpress_url: http://leaskh.wordpress.com/2009/10/26/%e5%a4%a9%e6%9c%9d%e6%98%a5%e8%89%b2%e5%85%b3%e6%88%91%e4%b8%8d%e4%bd%8f%ef%bc%8c%e4%b8%80%e6%ae%b5%e4%bb%a3%e7%a0%81%e8%ae%a9%e6%88%91%e5%87%ba%e5%a2%99%e6%9d%a5%ef%bc%88flora_ssh-d-1-73%e9%9a%86
date: '2009-10-26 02:22:06 +0800'
date_gmt: '2009-10-26 02:22:06 +0800'
categories:

tags: []
comments: []
---
<div id="msgcns!15BAC1A170471DB!15075" class="bvMsg">
<p></p>
<p>Flora_ssh-D 1.73已经不单单是翻墙脚本了，目前我计划把Flora_ssh-D发展成一个自动化的助理，让你的电脑用得更舒心。
<p>目前的功能如下：
<ol>
<li>自动检查网络状态，根据在线和离线的状态为你开启和关闭软件；
<li>自动检查ssh -D的连接状态，如果断开了会为你自动连接，连接失败将提示自动重连，使用后墙对你来说基本上是透明的；
<li>VoiceOver语音功能，这个功能和iPod一样，你的iTunes在播放的时候能够语音提示你正在播放的歌名和艺术家名字；
<li>语音提醒功能的改进，当需要语音提示用户操作的时候，如果你的iTunes正在播放，将自动降低你的iTunes音量，在语音提示结束后还原音量；
<li>使用API自动将你正在收听的音乐记录到Last.fm，你已经不再需要额外的iTunes插件来记录了；
<li>使用API自动更新你在DNS-O-MATIC上的动态IP，你不再需要其他额外的软件更新动态IP了；
<li>新版本使用新的idle时间管理，对比上一个版本有很大的效能提升，后台的常驻几乎不占用任何资源。</li></ol>
<p>Google Code上下载地址如下：<a title="http://code.google.com/p/flora-ssh-d/downloads/list" href="http://code.google.com/p/flora-ssh-d/downloads/list" target="_blank">http://code.google.com/p/flora-ssh-d/downloads/list</a> （包含源代码）<br />// PS: 使用翻墙功能你需要先有SSH帐号，使用其他功能则不需要。</p>
<p>源代码如下：</p><br />
<blockquote>
<p>(* Flora_ssh-D // Version 1.73 // Code by Leask Huang // www.leaskh.com // i@leaskh.com *)
<p>(* ======= Variable Declaration ======= *)<br />global timeTry<br />global DNSResponse<br />global isOLast<br />global iTsCurDBID<br />global iTsORSoundVolume<br />global strSNGArtist<br />global strSNGName<br />global strSNGAlbum<br />global strSNGTrackNumber<br />global strSNGDuration
<p>(* ======= General Settings ======= *)<br />(* Custom these before you run this script *)<br />property SSHServerName : "***.*******.com" -- Set ssh -D ServerName (or leave it blank)<br />property SSHUserName : "*******" -- Set UserName (or leave it blank)<br />property SSHPasswd : "*******" -- Set Password (or leave it blank)<br />property TwitterUsername : "*******" -- If you don't want to update Twitter status, leave it blank<br />property TwitterPassword : "*******" -- same as above<br />property TwitterText : "@" &amp; TwitterUsername &amp; " is online now! // " &amp; (current date) -- same as above<br />property DNSUsername : "*******" -- Set DNS UserName (or leave it blank)<br />property DNSPassword : "*******" -- Set Password (or leave it blank)<br />property LastfmUsername : "*******" -- Set Last.fm UserName (or leave it blank)<br />property LastfmPassword : "*******" -- Set Password (or leave it blank)<br />property appStList : &#123;"***", "***"&#125; -- these aplications will launch while you are online (or leave it blank)<br />property appQuitList : &#123;"***", "***"&#125; -- these aplications will quit while you are offline (or leave it blank)
<p>(* ======= Main Script ======= *)<br />on run<br />&nbsp;&nbsp;&nbsp; set isOLast to ""<br />&nbsp;&nbsp;&nbsp; set iTsCurDBID to ""<br />end run
<p>on quit<br />&nbsp;&nbsp;&nbsp; continue quit<br />end quit
<p>on idle<br />&nbsp;&nbsp;&nbsp; if fnCheckNet() is true then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnSSHCnt()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isOLast is not "online" then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnAppStart()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnDNSUpdate()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnTwitter()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnLastfm()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set isOLast to "online"<br />&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isOLast is not "offline" then fnAppQuit()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set isOLast to "offline"<br />&nbsp;&nbsp;&nbsp; end if<br />&nbsp;&nbsp;&nbsp; return 180<br />end idle
<p>(* ======= Functions ======= *)<br />to fnCheckNet()<br />&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "curl --connect-timeout 33 "apple.com/favicon.ico""<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isOLast is not "online" then SmartSay("Online")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true<br />&nbsp;&nbsp;&nbsp; on error<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isOLast is not "offline" then SmartSay("Offline")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br />&nbsp;&nbsp;&nbsp; end try<br />end fnCheckNet
<p>to fnAppStart()<br />&nbsp;&nbsp;&nbsp; if (count appStList) > 0 then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("Start Apps")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat with intSti from 1 to (count appStList)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application (item intSti of appStList) to activate<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end repeat<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("OK")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on error<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("Failed")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end try<br />&nbsp;&nbsp;&nbsp; end if<br />end fnAppStart
<p>to fnAppQuit()<br />&nbsp;&nbsp;&nbsp; if (count appQuitList) > 0 then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("Quit Applications")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat with intSti from 1 to count appQuitList<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application (item intSti of appQuitList) to quit<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end repeat<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("OK")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on error<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("Failed")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end try<br />&nbsp;&nbsp;&nbsp; end if<br />end fnAppQuit
<p>to fnSSHCnt()<br />&nbsp;&nbsp;&nbsp; if (length of SSHServerName) > 0 and (length of SSHUserName) > 0 and (length of SSHPasswd) > 0 then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set timeTry to 0<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat while fnCheckSSHD() is false<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("Connect SSH D")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if timeTry > 0 then if (button returned of (display dialog "ssh -D connection failed." &amp; return &amp; "" buttons &#123;"Retry", "Ignore"&#125;)) is "Ignore" then exit repeat<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnShellSSH()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set timeTry to timeTry + 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end repeat<br />&nbsp;&nbsp;&nbsp; end if<br />end fnSSHCnt
<p>to fnCheckSSHD()<br />&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "curl --socks5 127.0.0.1:7070 --connect-timeout 33 "apple.com/favicon.ico""<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if timeTry > 0 then SmartSay("OK")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true<br />&nbsp;&nbsp;&nbsp; on error<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if timeTry > 0 then SmartSay("Failed")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br />&nbsp;&nbsp;&nbsp; end try<br />end fnCheckSSHD
<p>to fnShellSSH()<br />&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "Terminal"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quit<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; activate<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do script "rm ~/Downloads/.Flora_ssh-D.out" in window 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do script "killall ssh" in window 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do script "killall ssh-agent" in window 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do script "nohup ssh -D 7070 " &amp; SSHUserName &amp; "@" &amp; SSHServerName &amp; " > Downloads/.Flora_ssh-D.out" in window 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end tell<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("SSH D connection request and log in request have been sent. Waiting for response from remote server.")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "Terminal"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do script SSHPasswd in window 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quit<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end tell<br />&nbsp;&nbsp;&nbsp; end try<br />end fnShellSSH
<p>to fnTwitter()<br />&nbsp;&nbsp;&nbsp; if (length of TwitterUsername) > 0 and (length of TwitterPassword) > 0 and (length of TwitterText) > 0 then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&<br />
quot;Update Twitter state")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "curl --connect-timeout 33&nbsp; --user " &amp; (quoted form of (TwitterUsername &amp; ":" &amp; TwitterPassword)) &amp; " --data-binary " &amp; (quoted form of ("status=" &amp; TwitterText)) &amp; " "<a href="https://twitter.com/statuses/update.json""">https://twitter.com/statuses/update.json""</a><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("OK")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on error<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("Failed")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end try<br />&nbsp;&nbsp;&nbsp; end if<br />end fnTwitter
<p>to fnDNSShell()<br />&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set DNSResponse to (do shell script "curl --connect-timeout 33 "<a href="https://"">https://"</a> &amp; DNSUsername &amp; ":" &amp; DNSPassword &amp; "@updates.dnsomatic.com/nic/update?&amp;wildcard=NOCHG&amp;mx=NOCHG&amp;backmx=NOCHG"")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if first word of DNSResponse is "good" then -- (second word of DNSResponse) is IP address<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />&nbsp;&nbsp;&nbsp; on error<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br />&nbsp;&nbsp;&nbsp; end try<br />end fnDNSShell
<p>to fnDNSUpdate()<br />&nbsp;&nbsp;&nbsp; if (length of DNSUsername) > 0 and (length of DNSPassword) > 0 then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("Update dynamic IP")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if fnDNSShell() is true then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("OK")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("Failed")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />&nbsp;&nbsp;&nbsp; end if<br />end fnDNSUpdate
<p>to fnURLec(strToUEC)<br />&nbsp;&nbsp;&nbsp; return do shell script "python -c 'import sys, urllib; print urllib.quote(sys.argv[1])' "" &amp; strToUEC &amp; """<br />end fnURLec
<p>to fniTunesisActive()<br />&nbsp;&nbsp;&nbsp; tell application "System Events" to return (name of processes contains "iTunes")<br />end fniTunesisActive
<p>to fuisiTunesNUD()<br />&nbsp;&nbsp;&nbsp; if fniTunesisActive() is true then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "iTunes"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if player state is playing then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set iTsNewDBID to (get database ID of current track)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if iTsNewDBID is not iTsCurDBID then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strSNGArtist to (get artist of current track)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strSNGName to (get name of current track)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strSNGAlbum to (get album of current track)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strSNGTrackNumber to (get track number of current track)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strSNGDuration to (get duration of current track as integer)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set iTsCurDBID to iTsNewDBID<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end tell<br />&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br />&nbsp;&nbsp;&nbsp; end if<br />end fuisiTunesNUD
<p>to SmartSay(strToSay)<br />&nbsp;&nbsp;&nbsp; set isiTPing to false<br />&nbsp;&nbsp;&nbsp; if fniTunesisActive() is true then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "iTunes" to if player state is playing then set isiTPing to true<br />&nbsp;&nbsp;&nbsp; end if<br />&nbsp;&nbsp;&nbsp; if isiTPing is true then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "iTunes"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set iTsORSoundVolume to sound volume<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set sound volume to iTsORSoundVolume * 0.333<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end tell<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say "" &amp; strToSay<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "iTunes" to set sound volume to iTsORSoundVolume<br />&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say "" &amp; strToSay<br />&nbsp;&nbsp;&nbsp; end if<br />end SmartSay
<p>to fnLastfm()<br />&nbsp;&nbsp;&nbsp; if fuisiTunesNUD() is true then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (length of strSNGName) > 0 or (length of strSNGArtist) > 0 then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "iTunes"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set iTsORSoundVolume to sound volume<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set sound volume to iTsORSoundVolume * 0.333<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end tell<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (length of strSNGName) > 0 then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say strSNGName<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (length of strSNGArtist) > 0 then say strSNGArtist<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "iTunes" to set sound volume to iTsORSoundVolume<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (length of LastfmUsername) > 0 and (length of LastfmPassword) > 0 then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "curl --connect-timeout 33 "<a href="http://lastfmstats.livefrombmore.com/universalscrobbler/scrobble.php?submissionType=track"">http://lastfmstats.livefrombmore.com/universalscrobbler/scrobble.php?submissionType=track"</a> &amp; "&amp;username=" &amp; LastfmUsername &amp; "&amp;password=" &amp; LastfmPassword &amp; "&amp;artist=" &amp; fnURLec(strSNGArtist) &amp; "&amp;track=" &amp; fnURLec(strSNGName) &amp; "&amp;album=" &amp; fnURLec(strSNGAlbum) &amp; "&amp;number=" &amp; strSNGTrackNumber &amp; "&amp;duration=" &amp; strSNGDuration &amp; """<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on error<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay("Scrobbling Failed")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />&nbsp;&nbsp;&nbsp; end if<br />end fnLastfm</p></p></p></p></p></blockquote>  </div></p>
